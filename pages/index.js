import Head from 'next/head'
import Image from 'next/image'
import { Inter } from 'next/font/google'
import { useState, useEffect } from 'react';
import { NFC, Ndef } from '@awesome-cordova-plugins/nfc';
import { IonButton, IonHeader, IonText } from '@ionic/react';

const inter = Inter({ subsets: ['latin'] })

export default function Home() {

	const [tagData, setTagData] = useState(null);
	const [scanning, setScanning] = useState(false);
	// const nfc = new NFC();
	// const ndef = new Ndef();

	useEffect(() => {
		let readerMode$;
		if (scanning) {
			// Enable NFC reader mode when scanning is true
			let flags = NFC.FLAG_READER_NFC_A | NFC.FLAG_READER_NFC_V;
			readerMode$ = NFC.readerMode(flags).subscribe(
				tag => setTagData(tag),
				err => console.log('Error reading tag', err)
			);
		}

		// Clean up the subscription when the component unmounts or scanning is turned off
		return () => {
			if (readerMode$) {
				readerMode$.unsubscribe();
			}
		};
	}, [scanning]);

	const handleScanButton = () => {
		setScanning(true);
	};

	const handleStopButton = () => {
		setScanning(false);
		setTagData(null);
	};

	return (
		<>
			<Head>
				<title>Create Next App</title>
				<meta name="description" content="Generated by create next app" />
				<meta name="viewport" content="width=device-width, initial-scale=1" />
				<link rel="icon" href="/favicon.ico" />
			</Head>
			<div className='flex flex-col justify-center items-center h-screen text-center'>
				{scanning ? (
					<IonButton onClick={handleStopButton}>Stop Scanning</IonButton>
				) : (
					<IonButton onClick={handleScanButton}>Start Scanning</IonButton>
				)}
				{tagData ? (
					<div>
						<p>Tag ID: {tagData.id}</p>
						<p>Tag Type: {tagData.type}</p>
					</div>
				) : (
					<h1>Scan an NFC tag to see the data.</h1>
				)}
			</div>
		</>
	)
}
